<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligent Chat System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #2c2c2c;
            color: #ffffff;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background-color: #1a1a1a;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            color: #ffffff;
            font-size: 24px;
            font-weight: 600;
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            max-height: calc(100vh - 200px);
        }
        
        .messages-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #333333;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            max-width: 80%;
        }
        
        .user-message {
            background-color: #6c757d;
            color: #ffffff;
            margin-left: auto;
            text-align: right;
        }
        
        .bot-message {
            background-color: #404040;
            color: #ffffff;
            margin-right: auto;
        }
        
        .sidebar {
            width: 300px;
            background-color: #404040;
            padding: 20px;
            overflow-y: auto;
        }
        
        .sidebar h3 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #555555;
        }
        
        .stat-label {
            color: #cccccc;
            font-size: 14px;
        }
        
        .stat-value {
            color: #ffffff;
            font-weight: 500;
            font-size: 14px;
        }
        
        .input-area {
            background-color: #1a1a1a;
            padding: 20px;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .message-input {
            flex: 1;
            padding: 12px 16px;
            background-color: #6c757d;
            border: none;
            color: #ffffff;
            font-size: 16px;
            outline: none;
        }
        
        .message-input::placeholder {
            color: #cccccc;
        }
        
        .send-button {
            padding: 12px 24px;
            background-color: #6c757d;
            color: #ffffff;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .send-button:hover {
            background-color: #5a6268;
        }
        
        .clear-button {
            padding: 12px 24px;
            background-color: #8b0000;
            color: #ffffff;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .clear-button:hover {
            background-color: #660000;
        }
        
        .loading {
            display: none;
            color: #cccccc;
            font-style: italic;
            padding: 12px 16px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Intelligent Chat System</h1>
    </div>
    
    <div class="chat-container">
        <div class="messages-area" id="messagesArea">
            <div class="message bot-message">
                Hello! I'm an intelligent chat system with advanced machine learning capabilities. I can:
                <br><br>
                <strong>Analyze text using NLP</strong> - Natural language processing with entity recognition, intent detection, and pattern analysis
                <br>
                <strong>Learn from conversations</strong> - Adaptive learning system that improves responses over time
                <br>
                <strong>Provide contextual responses</strong> - Using 100+ datasets covering programming, business, and language patterns
                <br>
                <strong>Recommend storage strategies</strong> - AI-powered analysis for optimal data storage solutions
                <br>
                <strong>Multi-language support</strong> - Grammar analysis and multilingual understanding
                <br><br>
                <div class="welcome-message">
                Advanced ML Chat System - Updated v2.1
            </div>
            </div>
        </div>
        
        <div class="sidebar">
            <h3>Session Analytics</h3>
            <div class="stat-item">
                <span class="stat-label">Messages</span>
                <span class="stat-value" id="messageCount">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ML Learning</span>
                <span class="stat-value" id="learningCount">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Confidence</span>
                <span class="stat-value" id="confidenceAvg">0%</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Entities</span>
                <span class="stat-value" id="entitiesCount">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Patterns</span>
                <span class="stat-value" id="patternsCount">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Knowledge Base</span>
                <span class="stat-value" id="memoryCount">0</span>
            </div>
            
            <h3 style="margin-top: 20px;">Features Active</h3>
            <div class="stat-item">
                <span class="stat-label">NLP Analysis</span>
                <span class="stat-value">✓</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ML Learning</span>
                <span class="stat-value">✓</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Storage AI</span>
                <span class="stat-value">✓</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Multi-lang</span>
                <span class="stat-value">✓</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Datasets</span>
                <span class="stat-value">100+</span>
            </div>
        </div>
    </div>
    
    <div class="input-area">
        <input type="text" id="messageInput" class="message-input" placeholder="Type your message here..." maxlength="1000">
        <button onclick="sendMessage()" class="send-button">Send</button>
        <button onclick="clearChat()" class="clear-button">Clear</button>
    </div>
    
    <div class="loading" id="loading">Processing...</div>

    <script>
        let sessionId = generateSessionId();
        let messageCount = 0;
        let learningCount = 0;
        let totalConfidence = 0;
        let totalEntities = 0;
        let totalPatterns = 0;
        let memoryItems = 0;

        function generateSessionId() {
            return 'session_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        }

        function addMessage(content, isUser = false) {
            const messagesArea = document.getElementById('messagesArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            messageDiv.textContent = content;
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        function updateStats(data) {
            messageCount++;
            document.getElementById('messageCount').textContent = messageCount;
            
            if (data.should_learn) {
                learningCount++;
                document.getElementById('learningCount').textContent = learningCount;
            }
            
            if (data.features_analyzed && data.features_analyzed.confidence) {
                totalConfidence += data.features_analyzed.confidence;
                const avgConfidence = (totalConfidence / messageCount * 100).toFixed(1);
                document.getElementById('confidenceAvg').textContent = avgConfidence + '%';
            }
            
            if (data.analysis && data.analysis.entities) {
                totalEntities += data.analysis.entities.length;
                document.getElementById('entitiesCount').textContent = totalEntities;
            }
            
            if (data.analysis && data.analysis.patterns) {
                totalPatterns += data.analysis.patterns.length;
                document.getElementById('patternsCount').textContent = totalPatterns;
            }
            
            memoryItems++;
            document.getElementById('memoryCount').textContent = memoryItems;
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            input.value = '';
            addMessage(message, true);
            
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            
            try {
                const response = await fetch('/chat/process/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCsrfToken(),
                    },
                    body: JSON.stringify({
                        user_input: message,
                        data_content: message,
                        session_id: sessionId
                    })
                });
                
                const data = await response.json();
                loading.style.display = 'none';
                
                if (data.chat_response) {
                    addMessage(data.chat_response);
                    updateStats(data);
                } else if (data.error) {
                    addMessage('Error: ' + data.error);
                }
            } catch (error) {
                loading.style.display = 'none';
                addMessage('Connection error. Please try again.');
            }
        }

        function clearChat() {
            const messagesArea = document.getElementById('messagesArea');
            messagesArea.innerHTML = '<div class="message bot-message">Chat cleared. How can I help you?</div>';
            sessionId = generateSessionId();
            messageCount = 0;
            learningCount = 0;
            totalConfidence = 0;
            totalEntities = 0;
            totalPatterns = 0;
            memoryItems = 0;
            updateStatsDisplay();
        }

        function updateStatsDisplay() {
            document.getElementById('messageCount').textContent = messageCount;
            document.getElementById('learningCount').textContent = learningCount;
            document.getElementById('confidenceAvg').textContent = '0%';
            document.getElementById('entitiesCount').textContent = totalEntities;
            document.getElementById('patternsCount').textContent = totalPatterns;
            document.getElementById('memoryCount').textContent = memoryItems;
        }

        function getCsrfToken() {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'csrftoken') {
                    return value;
                }
            }
            return '';
        }

        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
